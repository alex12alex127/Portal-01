<div class="auth-box">
  <h1 class="auth-page__title">
    <svg class="icon icon--lg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.562-.047-1.159-.026-1.703.076A4.5 4.5 0 0016.5 10.5H14.5c-1.394 0-2.5-1.107-2.5-2.5s1.107-2.5 2.5-2.5h1.5a3 3 0 003-3z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 12.75l-1.5-1.5M7.5 15l-1.5-1.5" /></svg>
    Accedi
  </h1>
  <h2>Login</h2>
  <form id="loginForm">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <label for="login-username">Username</label>
    <input id="login-username" type="text" name="username" placeholder="Username" required>
    <label for="login-password">Password</label>
    <input id="login-password" type="password" name="password" placeholder="Password" required>
    <button type="submit" class="btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v3.75M15.75 9L12 12.75m0 0L8.25 9m3.75 3.75V21" /></svg> <span class="btn-text">Accedi</span></button>
  </form>
  <p><a href="<%= typeof basePath !== 'undefined' ? basePath : '' %>/auth/register">Registrati</a> Â· <a href="<%= typeof basePath !== 'undefined' ? basePath : '' %>/auth/forgot-password">Password dimenticata?</a></p>
  <div id="msg" role="status" aria-live="polite"></div>
  <script>
    (function(){ var base='<%= typeof basePath !== "undefined" ? basePath : "" %>';
    document.getElementById('loginForm').onsubmit=async function(e){
      e.preventDefault();
      var btn=this.querySelector('button'), txt=btn.querySelector('.btn-text'), msg=document.getElementById('msg');
      msg.textContent=''; msg.className=''; msg.removeAttribute('class');
      btn.disabled=true; if(txt) txt.textContent='Accesso in corso...';
      try{
        var r=await fetch(base+'/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.fromEntries(new FormData(this)))});
        var j;
        try{j=await r.json();}catch(_){j={};}
        if(j.success&&j.redirect){ location.href=j.redirect; return; }
        msg.textContent=j.error||'Errore'; msg.className='message-error';
      }catch(x){ msg.textContent='Errore di connessione'; msg.className='message-error'; }
      btn.disabled=false; if(txt) txt.textContent='Accedi';
    }; })();
  </script>
</div>
