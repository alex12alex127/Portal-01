<% const active = typeof activePage !== 'undefined' ? activePage : ''; const bp = typeof basePath !== 'undefined' ? basePath : ''; %>
<aside class="sidebar" id="sidebar">
  <div class="sidebar__head">
    <a href="<%= bp %>/dashboard" class="sidebar__brand">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
      Portal-01
    </a>
    <button type="button" class="sidebar__close" id="sidebarClose" aria-label="Chiudi">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
    </button>
  </div>
  <nav class="sidebar__nav">
    <a href="<%= bp %>/dashboard" class="sidebar__link <%= active === 'dashboard' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3A2.25 2.25 0 016 5.25h13.5A2.25 2.25 0 0121.75 7.5v10.5A2.25 2.25 0 0119.5 20.25H6.75a2.25 2.25 0 01-2.25-2.25V7.5A2.25 2.25 0 013.75 5.25zm0 2.25a.75.75 0 01.75-.75h13.5a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75H6.75a.75.75 0 01-.75-.75V7.5z" /><path stroke-linecap="round" stroke-linejoin="round" d="M6 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75zm0 4a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75zm0 4a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5H6.75a.75.75 0 01-.75-.75z" /></svg>
      Panoramica
    </a>
    <a href="<%= bp %>/ferie" class="sidebar__link <%= active === 'ferie' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5M12 3v1.5m0 15v1.5m9-9h-1.5M3.75 12H5.25m13.5 0a.75.75 0 01-1.5 0H5.25a.75.75 0 010-1.5h13.5a.75.75 0 010 1.5z" /></svg>
      Ferie
    </a>
    <a href="<%= bp %>/avvisi" class="sidebar__link <%= active === 'avvisi' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6L8.987 9.6a.75.75 0 00-1.05-.038 10.285 10.285 0 00-3.758 4.025c-.072.123-.144.246-.215.372a.75.75 0 00.037 1.016l.006.004c.167.52.626 1.021 1.018 1.48.615.739 1.453 1.19 2.4 1.19.947 0 1.785-.45 2.4-1.19.392-.459.851-.96 1.017-1.48a.75.75 0 00.037-1.016l.006-.004c-.071-.126-.143-.249-.215-.372a10.285 10.285 0 00-3.758-4.025.75.75 0 00-1.05.038l-.013.015a8.25 8.25 0 01-2.324-6.786zM8.25 10.5a.75.75 0 01.75.75v6.75a.75.75 0 01-1.5 0v-6.75a.75.75 0 01.75-.75zM13.5 10.5a.75.75 0 01.75.75v6.75a.75.75 0 01-1.5 0v-6.75a.75.75 0 01.75-.75z" /></svg>
      Avvisi
      <% if (typeof avvisiNonLetti !== 'undefined' && avvisiNonLetti > 0) { %>
        <span class="notification-badge" style="display: inline-block;"><%= avvisiNonLetti %></span>
      <% } %>
    </a>
    <a href="<%= bp %>/notifiche" class="sidebar__link <%= active === 'notifiche' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /><path stroke-linecap="round" stroke-linejoin="round" d="M9.348 20.907a12.034 12.034 0 00-6.347-3.426c-.712-.63-1.367-1.314-1.957-2.037a.75.75 0 00-1.152.082A9.97 9.97 0 015.85 17.85a.75.75 0 00-.729.615 10.97 10.97 0 01.074 1.994 15.07 15.07 0 004.082 2.493c.046.02.092.041.138.06a.75.75 0 00.09 1.385" /></svg>
      Notifiche
      <% if (typeof notificheNonLette !== 'undefined' && notificheNonLette > 0) { %>
        <span class="notification-badge" style="display: inline-block;"><%= notificheNonLette %></span>
      <% } %>
    </a>
    <a href="<%= bp %>/profile" class="sidebar__link <%= active === 'profile' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5V12a.75.75 0 01-1.5 0v-1.5a3.75 3.75 0 10-7.5 0v1.5a.75.75 0 01-1.5 0v-1.5a5.25 5.25 0 0110.5 0v1.5a.75.75 0 01-1.5 0V12a3.75 3.75 0 00-7.5 0v-1.5z" /></svg>
      Profilo
    </a>
    <% if (user && (user.role === 'admin' || user.role === 'manager')) { %>
    <span class="sidebar__group-label">Amministrazione</span>
    <% if (user.role === 'admin') { %>
    <a href="<%= bp %>/admin/users" class="sidebar__link <%= active === 'admin' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.75 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5v-7.5H8.25v7.5z" /></svg>
      Gestione Utenti
    </a>
    <% } %>
    <a href="<%= bp %>/admin/ferie" class="sidebar__link <%= active === 'adminFerie' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12c0 1.26-.21 2.465-.59 3.56" /></svg>
      Approva Ferie
    </a>
    <a href="<%= bp %>/admin/avvisi" class="sidebar__link <%= active === 'adminAvvisi' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 110-9h.75c.704 0 1.402-.03 2.09-.09a.75.75 0 01.53.91 15.099 15.099 0 01.53 1.072c.074.448.09.9.09 1.36a7.5 7.5 0 00-7.5 7.5h.75c.446 0 .912-.016 1.36-.05a.75.75 0 01.91.53c.06.688.09 1.386.09 2.09V18a9 9 0 009 9h.75a9 9 0 009-9v-.75c0-.704-.03-1.402-.09-2.09a.75.75 0 01-.91-.53 15.099 15.099 0 01-1.072-.53c-.448-.074-.9-.09-1.36-.09H18a4.5 4.5 0 110-9h-.75a7.5 7.5 0 00-7.5 7.5v.75c0 .446.016.912.05 1.36.05a.75.75 0 01-.53.91c-.688.06-1.386.09-2.09.09H7.5a9 9 0 01-9-9v-.75c0-.704.03-1.402.09-2.09z" /></svg>
      Gestione Avvisi
    </a>
    <% } %>
  </nav>
  <div class="sidebar__foot">
    <button type="button" class="sidebar__link theme-toggle" id="themeToggle" aria-label="Tema chiaro/scuro" title="Cambia tema">
      <svg class="icon icon--theme-light" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
      <svg class="icon icon--theme-dark" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
      <span class="theme-toggle__label">Tema</span>
    </button>
    <% if (user) { %><p class="sidebar__user"><%= user.full_name %></p><% } %>
    <a href="<%= bp %>/auth/logout" class="sidebar__link logout">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v3.75M15.75 9L12 12.75m0 0L8.25 9m3.75 3.75V21" /></svg>
      Esci
    </a>
  </div>
</aside>
<button type="button" class="sidebar__toggle" id="sidebarToggle" aria-label="Menu">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
</button>
<div class="sidebar__backdrop" id="sidebarBackdrop"></div>
<script>
(function(){
  var s=document.getElementById('sidebar'),t=document.getElementById('sidebarToggle'),c=document.getElementById('sidebarClose'),b=document.getElementById('sidebarBackdrop');
  if(!s||!t)return;
  function open(){s.classList.add('open');if(b)b.classList.add('open');document.body.style.overflow='hidden';}
  function close(){s.classList.remove('open');if(b)b.classList.remove('open');document.body.style.overflow='';}
  t.addEventListener('click',function(e){e.preventDefault();open();});
  if(c)c.addEventListener('click',function(e){e.preventDefault();close();});
  if(b)b.addEventListener('click',function(e){e.preventDefault();close();});
})();
(function(){
  var urls=['<%= bp %>/dashboard','<%= bp %>/ferie','<%= bp %>/avvisi','<%= bp %>/profile'<% if (user && user.role === 'admin') { %>,'<%= bp %>/admin/users'<% } %><% if (user && (user.role === 'admin' || user.role === 'manager')) { %>,'<%= bp %>/admin/ferie','<%= bp %>/admin/avvisi'<% } %>];
  function prefetch(){ urls.forEach(function(u){ var l=document.createElement('link'); l.rel='prefetch'; l.href=u; document.head.appendChild(l); }); }
  if(document.readyState==='complete') setTimeout(prefetch,300); else window.addEventListener('load',function(){ setTimeout(prefetch,300); });
})();
(function(){
  var stored = localStorage.getItem('portal-theme');
  var dark = stored === 'dark' || (!stored && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
  if (dark) document.documentElement.setAttribute('data-theme', 'dark');
  var btn = document.getElementById('themeToggle');
  if (btn) btn.addEventListener('click', function() {
    var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    if (isDark) { document.documentElement.removeAttribute('data-theme'); localStorage.setItem('portal-theme', 'light'); }
    else { document.documentElement.setAttribute('data-theme', 'dark'); localStorage.setItem('portal-theme', 'dark'); }
  });
})();
</script>
