<div class="auth-box">
  <h1><svg class="icon icon--lg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.862-.228-1.614-.686-2.031-1.261a6.003 6.003 0 01-3.27-5.687 6 6 0 0112 0c0 .921-.224 1.786-.627 2.575a6.003 6.003 0 01-3.27 5.687" /></svg> Portal-01</h1>
  <h2>Recupero password</h2>
  <p class="auth-hint">Inserisci l'email con cui ti sei registrato. Riceverai un link per reimpostare la password (valido 1 ora).</p>
  <form id="forgotForm">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <label for="forgot-email">Email</label>
    <input id="forgot-email" type="email" name="email" placeholder="Email" required>
    <button type="submit" class="btn"><span class="btn-text">Invia link</span></button>
  </form>
  <p><a href="<%= typeof basePath !== 'undefined' ? basePath : '' %>/auth/login">Torna al login</a></p>
  <div id="msg" role="status" aria-live="polite"></div>
  <script>
    (function(){ var base='<%= typeof basePath !== "undefined" ? basePath : "" %>';
    document.getElementById('forgotForm').onsubmit=async function(e){
      e.preventDefault();
      var btn=this.querySelector('button'), txt=btn.querySelector('.btn-text'), msg=document.getElementById('msg');
      msg.textContent=''; msg.className=''; msg.removeAttribute('class');
      btn.disabled=true; if(txt) txt.textContent='Invio...';
      try{
        var r=await fetch(base+'/auth/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.fromEntries(new FormData(this)))});
        var j; try{j=await r.json();}catch(_){j={};}
        if(j.success){ msg.textContent=j.message||'Controlla la tua email.'; msg.className='message-ok'; }
        else msg.textContent=j.error||'Errore'; msg.className=msg.className||'message-error';
      }catch(x){ msg.textContent='Errore di connessione'; msg.className='message-error'; }
      btn.disabled=false; if(txt) txt.textContent='Invia link';
    }; })();
  </script>
</div>
