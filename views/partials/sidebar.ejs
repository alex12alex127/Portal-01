<% const active = typeof activePage !== 'undefined' ? activePage : ''; const bp = typeof basePath !== 'undefined' ? basePath : ''; %>
<aside class="sidebar" id="sidebar">
  <div class="sidebar__head">
    <a href="<%= bp %>/dashboard" class="sidebar__brand">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
      Portal-01
    </a>
    <button type="button" class="sidebar__close" id="sidebarClose" aria-label="Chiudi">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
    </button>
  </div>
  <nav class="sidebar__nav">
    <a href="<%= bp %>/dashboard" class="sidebar__link <%= active === 'dashboard' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
      Dashboard
    </a>
    <a href="<%= bp %>/ferie" class="sidebar__link <%= active === 'ferie' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg>
      Ferie
    </a>
    <a href="<%= bp %>/avvisi" class="sidebar__link <%= active === 'avvisi' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
      Avvisi
    </a>
    <a href="<%= bp %>/admin/users" class="sidebar__link <%= active === 'admin' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" /></svg>
      Gestione Utenti
    </a>
    <% if (user && (user.role === 'admin' || user.role === 'manager')) { %>
    <a href="<%= bp %>/admin/ferie" class="sidebar__link <%= active === 'adminFerie' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      Approva Ferie
    </a>
    <a href="<%= bp %>/admin/avvisi" class="sidebar__link <%= active === 'adminAvvisi' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.166-.616-1.168-1.307 0-.704.58-1.277 1.287-1.277.708 0 1.273.57 1.273 1.27 0 .69-.485 1.304-1.392 1.304zM12 20.25c2.272 0 4.375-1.386 5.318-3.488-.698-.25-1.44-.384-2.218-.384-1.913 0-3.562.842-4.752 2.087-.597-.597-1.068-1.305-1.348-2.087-.28-.782-.42-1.62-.42-2.478 0-2.272 1.386-4.375 3.488-5.318-.25-.698-.384-1.44-.384-2.218 0-1.913.842-3.562 2.087-4.752 2.087-2.087 4.752-2.087 4.752-2.087.698.698 1.305 1.068 2.087 1.348.782.28 1.62.42 2.478.42 2.272 0 4.375-1.386 5.318-3.488.25.698.384 1.44.384 2.218 0 1.913-.842 3.562-2.087 4.752-2.087 2.087-4.752 2.087-4.752 2.087-.698-.698-1.068-1.305-1.348-2.087-.28-.782-.42-1.62-.42-2.478 0-.858.14-1.696.42-2.478.28-.782.751-1.49 1.348-2.087-2.087-2.087-2.087-4.752-2.087-4.752 0-.778.086-1.52.384-2.218C6.136 4.386 7.728 2.25 10 2.25s4.375 1.386 5.318 3.488c.698-.25 1.44-.384 2.218-.384 1.913 0 3.562.842 4.752 2.087 2.087 2.087 2.087 4.752 2.087 4.752 0 .778-.086 1.52-.384 2.218 1.136 1.136 1.886 2.562 2.218 4.002.08.358.12.73.12 1.114 0 .858-.14 1.696-.42 2.478-.28.782-.751 1.49-1.348 2.087.597.597 1.068 1.305 1.348 2.087.28.782.42 1.62.42 2.478 0 .384-.04.756-.12 1.114-.332 1.44-1.082 2.866-2.218 4.002C17.864 19.614 15.272 21.75 13 21.75c-2.272 0-4.375-1.386-5.318-3.488-.698.25-1.44.384-2.218.384-1.913 0-3.562-.842-4.752-2.087-2.087-2.087-2.087-4.752-2.087-4.752 0-.778.086-1.52.384-2.218-1.136-1.136-1.886-2.562-2.218-4.002-.08-.358-.12-.73-.12-1.114z" /></svg>
      Gestione Avvisi
    </a>
    <% } %>
    <a href="<%= bp %>/profile" class="sidebar__link <%= active === 'profile' ? 'active' : '' %>">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
      Profilo
    </a>
  </nav>
  <div class="sidebar__foot">
    <button type="button" class="sidebar__link theme-toggle" id="themeToggle" aria-label="Tema chiaro/scuro" title="Cambia tema">
      <svg class="icon icon--theme-light" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
      <svg class="icon icon--theme-dark" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
      <span class="theme-toggle__label">Tema</span>
    </button>
    <% if (user) { %><p class="sidebar__user"><%= user.full_name %></p><% } %>
    <a href="<%= bp %>/auth/logout" class="sidebar__link logout">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v3.75M15.75 9L12 12.75m0 0L8.25 9m3.75 3.75V21" /></svg>
      Esci
    </a>
  </div>
</aside>
<button type="button" class="sidebar__toggle" id="sidebarToggle" aria-label="Menu">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
</button>
<div class="sidebar__backdrop" id="sidebarBackdrop"></div>
<script>
(function(){
  var s=document.getElementById('sidebar'),t=document.getElementById('sidebarToggle'),c=document.getElementById('sidebarClose'),b=document.getElementById('sidebarBackdrop');
  if(!s||!t)return;
  function open(){s.classList.add('open');if(b)b.classList.add('open');}
  function close(){s.classList.remove('open');if(b)b.classList.remove('open');}
  t.onclick=open;if(c)c.onclick=close;if(b)b.onclick=close;
})();
(function(){
  var urls=['<%= bp %>/dashboard','<%= bp %>/ferie','<%= bp %>/avvisi','<%= bp %>/profile','<%= bp %>/admin/users'<% if (user && (user.role === 'admin' || user.role === 'manager')) { %>,'<%= bp %>/admin/ferie','<%= bp %>/admin/avvisi'<% } %>];
  function prefetch(){ urls.forEach(function(u){ var l=document.createElement('link'); l.rel='prefetch'; l.href=u; document.head.appendChild(l); }); }
  if(document.readyState==='complete') setTimeout(prefetch,300); else window.addEventListener('load',function(){ setTimeout(prefetch,300); });
})();
(function(){
  var stored = localStorage.getItem('portal-theme');
  var dark = stored === 'dark' || (!stored && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
  if (dark) document.documentElement.setAttribute('data-theme', 'dark');
  var btn = document.getElementById('themeToggle');
  if (btn) btn.addEventListener('click', function() {
    var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    if (isDark) { document.documentElement.removeAttribute('data-theme'); localStorage.setItem('portal-theme', 'light'); }
    else { document.documentElement.setAttribute('data-theme', 'dark'); localStorage.setItem('portal-theme', 'dark'); }
  });
})();
</script>
